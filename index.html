<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pavan Patel Impact Assessment</title>
  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
      w[l] = w[l] || []; w[l].push({
        'gtm.start':
          new Date().getTime(), event: 'gtm.js'
      }); var f = d.getElementsByTagName(s)[0],
        j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
          'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
    })(window, document, 'script', 'dataLayer', 'GTM-T32C4QGP');</script>
  <!-- End Google Tag Manager -->
  <meta name='impact-site-verification' value='de48fbd4-f589-4ea8-9dc6-317125be028d'>
</head>

<body>
  <div class="container">
    <h1>Pavan Patel Impact Assessment</h1>
    <button id="bin-btn">HTTP Bin Button</button>
    <p><a href="https://pavanpatel-impact.github.io/pavan.impact/index2.html">Visit Github</a></p>
  </div>
<script src="/73b98e4b062b810e8c1cdd3e742fbbc10d8d733e1a21a27e682f0f9863526ffe/ns.js"></script></body>

<script>
  async function makeApiCall(key, value) {
    // if key and value both exists, only then make the api call
    if (key && value) {
      const response = await fetch(`https://httpbin.org/get?key=${key}&value=${value}`);
      const data = await response.json();

      console.log(data);
    }
  }

  async function getDataAndMakeApiCall() {
    // check if data layer exists and if data layer has a item in the array with property event name paramData
    // event name paramData is set in Google Tag Manager in the custom HTML
    if (dataLayer && dataLayer.filter(data => data.event === 'paramData').length > 0) {
      // filter and get only paramData event
      const paramData = dataLayer.filter(data => data.event === 'paramData')[0];

      // extract key, value from paraData
      const key = paramData.key;
      const value = paramData.value;

      await makeApiCall(key, value); //this is making an API call and appending the values to the URL.
    }
  }

  const binBtn = document.querySelector('#bin-btn');

  binBtn.addEventListener('click', getDataAndMakeApiCall);
</script>
</html>
